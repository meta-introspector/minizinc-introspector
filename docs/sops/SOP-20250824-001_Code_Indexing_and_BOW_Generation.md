# Standard Operating Procedure: Code Indexing and Bag-of-Words Generation

**Date:** August 24, 2025
**Author:** Gemini CLI

## 1. Purpose

This SOP outlines the standardized procedure for generating and utilizing `.file_analysis_summary.json` files within the `libminizinc` project. These files contain pre-computed bag-of-words representations of source code, enabling efficient code indexing, semantic analysis, and similarity comparisons.

## 2. Scope

This SOP applies to all development and analysis workflows that involve code indexing, semantic analysis, or require efficient access to code content summaries. It primarily concerns the operation and output of the `file_content_analyzer` tool.

## 3. Prerequisites

*   A functional `libminizinc` development environment.
*   The `file_content_analyzer` tool (located in `crates/file_content_analyzer` and built to `target/debug/file_content_analyzer` or `target/release/file_content_analyzer`).

## 4. Procedure: Generating `.file_analysis_summary.json` Files

`.file_analysis_summary.json` files are generated by the `file_content_analyzer` tool. This tool can operate in various modes, including incremental indexing, to efficiently update the code index.

### 4.1 Full Indexing (Initial Generation or Full Rebuild)

To perform a full analysis and generate/rebuild all `.file_analysis_summary.json` files for a given project root:

```bash
target/debug/file_content_analyzer --mode full_analysis --project-root /path/to/your/project
```

*   **`--mode full_analysis`**: Instructs the tool to process all relevant files from the specified project root.
*   **`--project-root /path/to/your/project`**: Specifies the absolute path to the root directory of the codebase to be indexed. The tool will traverse this directory recursively.

Upon completion, `.file_analysis_summary.json` files will be created in each directory containing analyzed source files, summarizing the content of files within that directory and its subdirectories.

### 4.2 Incremental Indexing (Updating Existing Summaries)

For subsequent runs, the `file_content_analyzer` supports incremental indexing, which significantly reduces processing time by only re-analyzing changed files. The exact command for incremental mode will depend on the implementation details of `file_content_analyzer`, but it typically involves a similar command with a different mode or flag:

```bash
target/debug/file_content_analyzer --mode incremental_analysis --project-root /path/to/your/project
```

*   **`--mode incremental_analysis`**: (Hypothetical, based on `CRQ-20250820-001.md`) This mode would leverage a persistent cache to identify and re-process only files that have been added, modified, or deleted since the last run.

### 4.3 Work Estimation (Pre-analysis)

To estimate the work involved in an indexing operation (e.g., how many files will be processed, estimated time):

```bash
target/debug/file_content_analyzer --mode estimate --project-root /path/to/your/project
```

*   **`--mode estimate`**: (Hypothetical, based on `CRQ-20250820-001.md`) This mode provides a report of pending changes without performing the actual indexing.

## 5. Utilizing `.file_analysis_summary.json` Files

These files are designed to be consumed by other tools and processes for various analytical tasks:

*   **Semantic Similarity:** Tools like `git_diff_analyzer` (currently under development) can read these files to quickly compare the semantic content of code changes (from Git diffs) with existing CRQs or other codebases.
*   **Code Navigation and Search:** Future tools can leverage these summaries for intelligent code search and navigation, identifying relevant files based on conceptual similarity rather than exact keyword matches.
*   **Project Overview:** Aggregating data from multiple `.file_analysis_summary.json` files can provide a high-level overview of the project's linguistic and thematic composition.

## 6. Maintenance and Best Practices

*   **Regular Generation:** Ensure that the `file_content_analyzer` is run regularly (e.g., as part of CI/CD pipelines or pre-commit hooks) to keep the `.file_analysis_summary.json` files up-to-date.
*   **Version Control:** `.file_analysis_summary.json` files should generally be committed to version control to ensure consistency across development environments and to enable historical analysis.
*   **Troubleshooting:** If analysis results seem outdated or incorrect, a full re-indexing (`--mode full_analysis`) may be necessary.

## 7. Related Documentation

*   **Change Request: Implement Incremental Indexing, Work Estimation, and Profiling for the Code Analyzer (`CRQ-20250820-001.md`)**
*   **Change Request: Discovery and Purpose of `.file_analysis_summary.json` (`CRQ-20250824-001_File_Analysis_Summary_Discovery.md`)**

## 8. Revision History

| Date         | Version | Description        | Author     |
| :----------- | :------ | :----------------- | :--------- |
| 2025-08-24   | 1.0     | Initial document   | Gemini CLI |
